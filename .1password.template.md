# 1Password Setup for k8s-gitops

This project uses 1Password CLI to manage sensitive files. After a fresh system install, you only need to run:

```bash
op signin
make secrets-init
```

## Required 1Password Items

Create these items in your 1Password vault (default vault: `Private`):

### 1. `k8s-gitops-kubeconfig` (Document)

Upload your `kubeconfig.yaml` file as a document.

```bash
# To save your current kubeconfig to 1Password:
op document create metal/kubeconfig.yaml --title="k8s-gitops-kubeconfig" --vault="Private"
```

### 2. `k8s-gitops-terraform` (Secure Note)

Create a Secure Note with these fields:

| Field Name              | Type     | Description                          |
|-------------------------|----------|--------------------------------------|
| `cloudflare_email`      | text     | Your Cloudflare account email        |
| `cloudflare_api_key`    | password | Cloudflare Global API Key            |
| `cloudflare_account_id` | text     | Cloudflare Account ID                |
| `ntfy_url`              | text     | ntfy server URL (e.g., https://ntfy.sh) |
| `ntfy_topic`            | text     | ntfy topic name                      |
| `extra_secrets`         | text     | (Optional) HCL map, e.g., `"key1" = "value1"` |

```bash
# To create via CLI:
op item create --category="Secure Note" --title="k8s-gitops-terraform" --vault="Private" \
  'cloudflare_email[text]=your@email.com' \
  'cloudflare_api_key[password]=your-api-key' \
  'cloudflare_account_id[text]=your-account-id' \
  'ntfy_url[text]=https://ntfy.sh' \
  'ntfy_topic[text]=your-topic'
```

## Environment Variables

You can customize the vault and item names:

```bash
export OP_VAULT="MyVault"
export OP_KUBECONFIG_ITEM="my-kubeconfig"
export OP_TERRAFORM_ITEM="my-terraform-secrets"
make secrets-init
```

## Updating Secrets

When you update secrets locally, push them back to 1Password:

```bash
# Update kubeconfig
op document edit k8s-gitops-kubeconfig --vault="Private" metal/kubeconfig.yaml

# For terraform secrets, edit in 1Password GUI or recreate the item
```
