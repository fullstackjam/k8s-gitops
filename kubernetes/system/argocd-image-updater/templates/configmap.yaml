apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-image-updater-config
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: argocd-image-updater
    app.kubernetes.io/part-of: argocd
data:
  registries.conf: |
    registries:
    {{- range .Values.imageUpdater.config.registries }}
    - name: {{ .name }}
      prefix: {{ .prefix }}
      api_url: {{ .api_url }}
      credentials: {{ .credentials }}
    {{- end }}
  commit.template: |
    build: update {{.AppName}} from {{.OldImage}} to {{.NewImage}}

    Automated image update:

    - {{.AppName}} image updated from `{{.OldImage}}` to `{{.NewImage}}`
    - {{range .Images}}  - {{.Name}}: {{.OldTag}} -> {{.NewTag}}
    {{end}}

    {{if .KustomizeImages}}Kustomize images:
    {{range .KustomizeImages}}  - {{.Name}}: {{.OldTag}} -> {{.NewTag}}
    {{end}}{{end}}
