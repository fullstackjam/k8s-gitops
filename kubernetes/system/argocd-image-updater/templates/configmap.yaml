apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-image-updater-config
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: argocd-image-updater
    app.kubernetes.io/part-of: argocd
data:
  registries.conf: |
    registries:
    {{- range .Values.imageUpdater.config.registries }}
    - name: {{ .name }}
      prefix: {{ .prefix }}
      api_url: {{ .api_url }}
      credentials: {{ .credentials }}
    {{- end }}
    credentials:
    {{- range .Values.imageUpdater.config.credentials }}
    - name: {{ .name }}
      url: {{ .url }}
      usernameSecret:
        name: {{ .usernameSecret.name }}
        key: {{ .usernameSecret.key }}
      passwordSecret:
        name: {{ .passwordSecret.name }}
        key: {{ .passwordSecret.key }}
    {{- end }}
