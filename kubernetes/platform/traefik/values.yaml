traefik:
  deployment:
    enabled: true
    replicas: 3

  # Enable Ingress support with nginx as main ingress
  ingressClass:
    enabled: false

  # Disable Gateway API provider - using nginx Ingress instead
  providers:
    kubernetesGateway:
      enabled: false

  # Configure entry points
  ports:
    web:
      port: 8000
      exposedPort: 80
      protocol: TCP
    websecure:
      port: 8443
      exposedPort: 443
      protocol: TCP

  # Enable Traefik dashboard via IngressRoute (internal only)
  ingressRoute:
    dashboard:
      enabled: true
      entryPoints: ["traefik"]

  # Disable Gateway API configuration
  gatewayClass:
    enabled: false

  gateway:
    enabled: false

  # Enable metrics for Prometheus
  metrics:
    prometheus:
      service:
        enabled: true
      serviceMonitor:
        enabled: true

  # Service configuration
  service:
    enabled: true
    type: LoadBalancer

  # Extra objects to deploy - Certificate and Ingress for dashboard
  extraObjects:
    - apiVersion: cert-manager.io/v1
      kind: Certificate
      metadata:
        name: traefik-dashboard
        namespace: traefik
      spec:
        secretName: traefik-tls-certificate
        issuerRef:
          name: letsencrypt-prod
          kind: ClusterIssuer
        dnsNames:
          - traefik.fullstackjam.com

    - apiVersion: networking.k8s.io/v1
      kind: Ingress
      metadata:
        name: traefik-dashboard
        namespace: traefik
        annotations:
          external-dns.alpha.kubernetes.io/target: "homelab-tunnel.fullstackjam.com"
          external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
      spec:
        ingressClassName: nginx
        tls:
          - hosts:
              - traefik.fullstackjam.com
            secretName: traefik-tls-certificate
        rules:
          - host: traefik.fullstackjam.com
            http:
              paths:
                - path: /dashboard
                  pathType: Prefix
                  backend:
                    service:
                      name: traefik
                      port:
                        number: 9000
                - path: /api
                  pathType: Prefix
                  backend:
                    service:
                      name: traefik
                      port:
                        number: 9000
